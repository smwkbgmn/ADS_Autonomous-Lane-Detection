{
	"name": "Lane Detection - CARLA Client",
	"build": {
		"dockerfile": "Dockerfile",
		"context": "..",
		"args": {
			"CARLA_VERSION": "0.9.16"
		}
	},

	// Use x86_64 architecture (required for CARLA Python client)
	"runArgs": [
		"--platform=linux/amd64",
		"--network=host",
		"--ipc=host"
	],

	// Features to install
	"features": {
		"ghcr.io/devcontainers/features/common-utils:2": {
			"installZsh": true,
			"installOhMyZsh": true,
			"upgradePackages": true
		},
		"ghcr.io/devcontainers/features/git:1": {
			"version": "latest"
		}
	},

	// VSCode extensions to install
	"customizations": {
		"vscode": {
			"extensions": [
				"ms-python.python",
				"ms-python.vscode-pylance",
				"ms-python.black-formatter",
				"ms-toolsai.jupyter",
				"streetsidesoftware.code-spell-checker"
			],
			"settings": {
				"python.defaultInterpreterPath": "/usr/local/bin/python",
				"python.linting.enabled": true,
				"python.linting.pylintEnabled": true,
				"python.formatting.provider": "black",
				"editor.formatOnSave": true,
				"editor.rulers": [88, 120],
				"files.trimTrailingWhitespace": true,
				"terminal.integrated.defaultProfile.linux": "bash",
				"terminal.integrated.profiles.linux": {
					"bash": {
						"path": "/bin/bash",
						"args": []
					}
				}
			}
		}
	},

	// Forward ports from container to host
	"forwardPorts": [8080, 5555],

	// Post-create command to set up environment
	"postCreateCommand": "pip install --no-cache-dir -r requirements.txt && echo 'âœ… Dev Container ready! Connect to remote CARLA server with: python main.py --host <REMOTE_IP> --port 2000'",

	// Use 'forwardPorts' to make a list of ports inside the container available locally.
	"portsAttributes": {
		"2000": {
			"label": "CARLA RPC",
			"onAutoForward": "notify"
		},
		"8080": {
			"label": "Web Viewer",
			"onAutoForward": "openBrowser",
			"protocol": "http"
		},
		"5555": {
			"label": "Detection Server",
			"onAutoForward": "notify"
		}
	},

	// Set environment variables
	"containerEnv": {
		"PYTHONUNBUFFERED": "1",
		"DISPLAY": "host.docker.internal:0",
		"QT_X11_NO_MITSHM": "1",
		"QT_DEBUG_PLUGINS": "0"
	},

	// Uncomment to connect as root instead
	// "remoteUser": "root",
	"remoteUser": "vscode"
}
