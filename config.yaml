# Lane Detection System Configuration

# CARLA Settings
carla:
  host: "ubuntu.local"
  port: 2000
  timeout: 10.0
  vehicle_type: "vehicle.tesla.model3"

# Camera Settings
camera:
  width: 800
  height: 600
  fov: 90.0
  position:
    x: 2.0   # Forward from vehicle center
    y: 0.0   # Right from vehicle center
    z: 1.5   # Up from vehicle center
  rotation:
    pitch: -10.0  # Tilt down
    yaw: 0.0
    roll: 0.0

# Lane Detection - Computer Vision
cv_detector:
  # Canny edge detection
  canny_low: 50
  canny_high: 150

  # Hough transform
  hough_rho: 2
  hough_theta: 0.017453  # 1 degree in radians (pi/180)
  hough_threshold: 50
  hough_min_line_len: 40
  hough_max_line_gap: 100

  # Temporal smoothing
  smoothing_factor: 0.7

  # Lane detection thresholds
  min_slope: 0.5  # Minimum absolute slope to be considered a lane

  # ROI configuration (broader detection area)
  roi_bottom_left_x: 0.05   # Fraction of width (bottom-left corner)
  roi_top_left_x: 0.35      # Fraction of width (top-left corner)
  roi_top_right_x: 0.65     # Fraction of width (top-right corner)
  roi_bottom_right_x: 0.95  # Fraction of width (bottom-right corner)
  roi_top_y: 0.5            # Fraction of height (look at top 50% of image)

# Lane Detection - Deep Learning
dl_detector:
  model_type: "pretrained"  # 'pretrained', 'simple', or 'full'
  input_size: [256, 256]
  threshold: 0.5
  device: "auto"  # 'cpu', 'cuda', or 'auto'

# Lane Analysis
lane_analyzer:
  drift_threshold: 0.15      # 15% of lane width
  departure_threshold: 0.35  # 35% of lane width
  lane_width_meters: 3.7     # Standard US highway lane
  max_heading_degrees: 30.0  # Maximum heading angle

  # Steering controller gains
  kp: 0.5  # Proportional gain
  kd: 0.1  # Derivative gain

# Throttle Control Policy
# Adaptive throttle reduces speed during sharp turns to prevent overshooting
throttle_policy:
  base: 0.14              # Base throttle when steering is minimal
  min: 0.05               # Minimum throttle during sharp turns
  steer_threshold: 0.15   # Steering magnitude to start reducing throttle
  steer_max: 0.70         # Maximum expected steering magnitude

# Visualization
visualization:
  show_spectator_overlay: true
  follow_with_spectator: false
  alert_blink_frequency: 10

  # Display options
  show_hud: true
  show_steering: true
  fill_lane: true
  enable_alerts: true
  save_video: false
  video_path: "output.mp4"

  # Web viewer port
  web_port: 8080

  # Colors (BGR format for OpenCV)
  color_left_lane: [255, 0, 0]    # Blue
  color_right_lane: [0, 0, 255]   # Red
  color_lane_fill: [0, 255, 0]    # Green
  color_centered: [0, 255, 0]     # Green
  color_drift: [0, 255, 255]      # Yellow
  color_departure: [0, 0, 255]    # Red

  # HUD settings
  hud_font_scale: 0.6
  hud_thickness: 2
  hud_margin: 20

# System
system:
  detection_method: "cv"  # "cv" or "dl"
  target_fps: 30
  enable_logging: true
  log_file: "lkas.log"

# LKAS Launcher
launcher:
  # Process retry configuration
  retry_count: 60           # Number of retries for server connections
  retry_delay: 0.5          # Delay between retries in seconds

  # Process initialization timeouts
  decision_init_timeout: 3.0    # Decision server initialization timeout (seconds)
  detection_init_timeout: 4.0   # Detection server initialization timeout (seconds)
  process_stop_timeout: 5.0     # Graceful process termination timeout (seconds)

  # Terminal display
  terminal_width: 70        # Width of terminal output
  enable_footer: true       # Enable persistent footer display

  # Logging
  log_file: "lkas_run.log"  # Path to launcher log file

  # Broadcasting (ZMQ)
  jpeg_quality: 85          # JPEG quality for frame broadcasting (0-100)
  broadcast_log_interval: 100  # Log broadcast status every N frames
