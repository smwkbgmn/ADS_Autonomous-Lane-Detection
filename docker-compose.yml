# Docker Compose for CARLA Simulator
# Usage:
#   docker-compose up    # Start CARLA server
#   docker-compose down  # Stop CARLA server

version: '3.8'

services:
  carla:
    image: carlasim/carla:0.9.15
    platform: linux/amd64  # Required for M1/M2 Macs (uses Rosetta 2)
    ports:
      - "2000:2000"  # CARLA RPC port
      - "2001:2001"  # CARLA streaming port
      - "2002:2002"  # CARLA additional port
    command: >
      /bin/bash -c "
      ./CarlaUE4.sh -RenderOffScreen -quality-level=Low -benchmark -fps=20
      "
    deploy:
      resources:
        limits:
          memory: 8G
          cpus: '4.0'
    restart: unless-stopped
    networks:
      - carla-network

networks:
  carla-network:
    driver: bridge

# Performance notes for M1/M2:
# - Uses Rosetta 2 emulation (enable in Docker Desktop settings)
# - Lower quality and FPS for better performance
# - Adjust memory/CPU limits based on your Mac's specs
#
# Alternative commands:
# - High quality: ./CarlaUE4.sh -RenderOffScreen
# - Low quality: ./CarlaUE4.sh -RenderOffScreen -quality-level=Low
# - With FPS limit: ./CarlaUE4.sh -RenderOffScreen -benchmark -fps=20
